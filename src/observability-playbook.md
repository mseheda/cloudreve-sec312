# Runbook та Incident Response

## Загальні положення
Цей документ описує порядок дій під час інцидентів безпеки та стабільності системи.  
Мета — швидка і контрольована реакція, мінімізація впливу на користувачів та збереження даних.

---

## Scenario 1: High CPU Usage

### Опис
Алерт спрацьовує, якщо використання CPU залишається на рівні **≥ 80% протягом 5 хвилин**.  
Можливі причини:
- DDoS-атака
- Завислі або некоректно працюючі процеси
- Аномально високе навантаження від користувачів

### Source Alarm
- **High-CPU-Usage** (CloudWatch Alarm)

---

### Actions

#### Verification
1. Перевірити активний алерт у **CloudWatch Alarms**
2. Переконатися, що CPU Usage все ще ≥ 80%

#### Investigation
1. Підключитися до EC2 інстансу через SSH
2. Виконати команду:
   ```bash
   top
   ```
3. Визначити процеси з найбільшим використанням CPU
4. Якщо знайдено проблемний процес:
    - Перезапустити його, або 
    - Завершити процес (`kill` / `kill -9`)
5. Якщо проблема не вирішується:
    - Перезапустити EC2 інстанс через AWS Console

---

## Scenario 2: Critical Data Deletion

### Опис
Алерт спрацьовує, якщо зафіксовано **10 або більше операцій видалення** даних з S3 Customer Data bucket протягом **1 хвилини**.
Може свідчити про:
- Зловмисне видалення даних
- Компрометацію облікового запису

### Source Alarm
- **S3-Data-Deletion** (CloudWatch / CloudTrail based)

--- 

### Actions

#### Verification
1. Перевірити Event History у CloudTrail
2. Визначити:
    - source IP
    - користувача (IAM User / Role)
    - Якщо джерело — S3 Lifecycle Manager:
        - Вважати алерт false positive
        - Завершити обробку інциденту
    - Якщо ні — перейти до containment
        - Containment:
            - Якщо користувач відомий:
                - Деактивувати обліковий запис
                - Примусово змінити пароль / ключі доступу
            - Якщо користувач невідомий:
                - В S3 → Permissions → Bucket Policy
                - Тимчасово застосувати політику Deny на всі delete-операції

#### Investigation
1. Знайти перший випадок видалення
2. Визначити source IP
3. Перевірити, чи виконувалися інші дії з цього IP:
    - читання (GetObject)
    - копіювання
    - листинг bucket
4. Оцінити ризик витоку даних
5. Заблокувати IP (Security Group / NACL / WAF)

#### Recovery
1. Відновити видалені дані з Backup
2. Перевірити цілісність та актуальність відновлених даних
3. Задокументувати інцидент та виконані дії

---

## Post-Incident Actions (для обох сценаріїв)
1. Провести root cause analysis
2. Оновити алерти або порогові значення (за потреби)
3. Оновити runbook на основі отриманого досвіду
4. Повідомити відповідальних осіб (L2 support, buissness owner of asset)
